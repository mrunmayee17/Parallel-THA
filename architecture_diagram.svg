<svg width="1200" height="900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
     refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" flood-color="#000" flood-opacity="0.1"/>
    </filter>
  </defs>
  
  <!-- Title -->
  <text x="600" y="30" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Insurance Item Matcher - System Architecture Flow
  </text>
  
  <!-- User Input Layer -->
  <rect x="50" y="70" width="200" height="60" rx="10" fill="#3498db" filter="url(#shadow)"/>
  <text x="150" y="95" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">User Input</text>
  <text x="150" y="110" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">"MacBook Pro 14-inch M3"</text>
  <text x="150" y="122" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">"black leather couch"</text>
  
  <!-- Input Validation -->
  <rect x="320" y="70" width="180" height="60" rx="10" fill="#e67e22" filter="url(#shadow)"/>
  <text x="410" y="90" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Input Validation</text>
  <text x="410" y="105" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Length check (â‰¤1000 chars)</text>
  <text x="410" y="117" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Empty string validation</text>
  
  <!-- Item Description Parser -->
  <rect x="560" y="70" width="200" height="60" rx="10" fill="#9b59b6" filter="url(#shadow)"/>
  <text x="660" y="90" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Item Description Parser</text>
  <text x="660" y="105" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Extract brand, model, category</text>
  <text x="660" y="117" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Generate search queries</text>
  
  <!-- Research Goal Generation -->
  <rect x="820" y="70" width="180" height="60" rx="10" fill="#1abc9c" filter="url(#shadow)"/>
  <text x="910" y="90" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Research Goal</text>
  <text x="910" y="105" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Create structured query</text>
  <text x="910" y="117" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Define output schema</text>
  
  <!-- API Strategy Selection Box -->
  <rect x="400" y="170" width="200" height="90" rx="10" fill="#f39c12" filter="url(#shadow)"/>
  <text x="500" y="190" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">API Strategy Selection</text>
  <text x="500" y="205" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">ðŸ”„ Search First (Default)</text>
  <text x="500" y="217" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">ðŸŽ¯ Task First (Quality)</text>
  <text x="500" y="229" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">âš¡ Search Only (Speed)</text>
  <text x="500" y="241" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">ðŸš€ Task Only (Best)</text>
  <text x="500" y="253" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">Configurable in Streamlit UI</text>
  
  <!-- Task API Branch -->
  <rect x="200" y="320" width="200" height="80" rx="10" fill="#27ae60" filter="url(#shadow)"/>
  <text x="300" y="340" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Parallel AI Task API</text>
  <text x="300" y="355" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Deep research capability</text>
  <text x="300" y="367" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Structured JSON output</text>
  <text x="300" y="379" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Base/Pro/Ultra processor</text>
  <text x="300" y="391" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ 5-minute timeout</text>
  
  <!-- Search API Branch -->
  <rect x="600" y="320" width="200" height="80" rx="10" fill="#2980b9" filter="url(#shadow)"/>
  <text x="700" y="340" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Parallel AI Search API</text>
  <text x="700" y="355" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Fast product discovery</text>
  <text x="700" y="367" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Content extraction</text>
  <text x="700" y="379" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Fallback mechanism</text>
  <text x="700" y="391" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Beta search endpoint</text>
  
  <!-- JSON Processing -->
  <rect x="400" y="450" width="200" height="80" rx="10" fill="#8e44ad" filter="url(#shadow)"/>
  <text x="500" y="470" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">JSON Processing</text>
  <text x="500" y="485" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Multi-strategy parsing</text>
  <text x="500" y="497" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Handle malformed JSON</text>
  <text x="500" y="509" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Partial object extraction</text>
  <text x="500" y="521" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Error recovery</text>
  
  <!-- Product Validation -->
  <rect x="100" y="580" width="150" height="60" rx="10" fill="#e74c3c" filter="url(#shadow)"/>
  <text x="175" y="600" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Product Validation</text>
  <text x="175" y="615" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Price parsing</text>
  <text x="175" y="627" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ URL validation</text>
  
  <!-- Confidence Scoring -->
  <rect x="320" y="580" width="150" height="60" rx="10" fill="#f39c12" filter="url(#shadow)"/>
  <text x="395" y="600" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Confidence Scoring</text>
  <text x="395" y="615" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Match quality (0-1)</text>
  <text x="395" y="627" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Relevance ranking</text>
  
  <!-- Data Transformation -->
  <rect x="540" y="580" width="150" height="60" rx="10" fill="#16a085" filter="url(#shadow)"/>
  <text x="615" y="600" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Data Transformation</text>
  <text x="615" y="615" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Pydantic models</text>
  <text x="615" y="627" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Type validation</text>
  
  <!-- Result Sorting -->
  <rect x="760" y="580" width="150" height="60" rx="10" fill="#7f8c8d" filter="url(#shadow)"/>
  <text x="835" y="600" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Result Sorting</text>
  <text x="835" y="615" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ By confidence</text>
  <text x="835" y="627" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Limit results</text>
  
  <!-- Output Formatting -->
  <rect x="400" y="720" width="200" height="80" rx="10" fill="#34495e" filter="url(#shadow)"/>
  <text x="500" y="740" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Output Formatting</text>
  <text x="500" y="755" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ SearchResult object</text>
  <text x="500" y="767" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Processing metadata</text>
  <text x="500" y="779" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ JSON/CSV export</text>
  <text x="500" y="791" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">â€¢ Streamlit display</text>
  
  <!-- User Interfaces -->
  <rect x="100" y="830" width="150" height="50" rx="10" fill="#9b59b6" filter="url(#shadow)"/>
  <text x="175" y="850" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Streamlit UI</text>
  <text x="175" y="865" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Interactive web app</text>
  
  <rect x="300" y="830" width="150" height="50" rx="10" fill="#e67e22" filter="url(#shadow)"/>
  <text x="375" y="850" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Python API</text>
  <text x="375" y="865" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Programmatic access</text>
  

  <rect x="700" y="830" width="150" height="50" rx="10" fill="#e74c3c" filter="url(#shadow)"/>
  <text x="775" y="850" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Export Options</text>
  <text x="775" y="865" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">JSON, CSV formats</text>
  
  <!-- Flow Arrows -->
  <line x1="250" y1="100" x2="320" y2="100" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="500" y1="100" x2="560" y2="100" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="760" y1="100" x2="820" y2="100" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <line x1="660" y1="130" x2="500" y2="170" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Strategy to API branches -->
  <line x1="450" y1="260" x2="300" y2="320" stroke="#27ae60" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="360" y="290" font-family="Arial, sans-serif" font-size="10" fill="#27ae60">Task API Path</text>
  
  <line x1="550" y1="260" x2="700" y2="320" stroke="#2980b9" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="640" y="290" font-family="Arial, sans-serif" font-size="10" fill="#2980b9">Search API Path</text>
  
  <!-- Fallback arrows (dashed) -->
  <line x1="400" y1="360" x2="600" y2="360" stroke="#e67e22" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="500" y="350" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#e67e22">Fallback Logic</text>
  
  <line x1="600" y1="360" x2="400" y2="360" stroke="#e67e22" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="500" y="380" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#e67e22">(Based on Strategy)</text>
  
  <!-- Convergence to JSON Processing -->
  <line x1="300" y1="400" x2="450" y2="450" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="700" y1="400" x2="550" y2="450" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Processing pipeline -->
  <line x1="500" y1="530" x2="175" y2="580" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="500" y1="530" x2="395" y2="580" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="500" y1="530" x2="615" y2="580" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="500" y1="530" x2="835" y2="580" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Convergence to output -->
  <line x1="175" y1="640" x2="450" y2="720" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="395" y1="640" x2="480" y2="720" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="615" y1="640" x2="520" y2="720" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="835" y1="640" x2="550" y2="720" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Final outputs -->
  <line x1="500" y1="800" x2="175" y2="830" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="500" y1="800" x2="375" y2="830" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <line x1="500" y1="800" x2="775" y2="830" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Error Handling Indicators -->
  <circle cx="380" cy="280" r="5" fill="#e74c3c"/>
  <text x="380" y="305" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#e74c3c">Error</text>
  <text x="380" y="315" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#e74c3c">Handling</text>
  
  <circle cx="620" cy="280" r="5" fill="#e74c3c"/>
  
  <!-- Strategy Performance Info -->
  <rect x="950" y="170" width="220" height="140" rx="5" fill="#ecf0f1" stroke="#bdc3c7"/>
  <text x="1060" y="190" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#2c3e50">Strategy Performance</text>
  
  <text x="970" y="210" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">ðŸ”„ Search First: ~2s + fallback</text>
  <text x="970" y="225" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">ðŸŽ¯ Task First: ~120s + fallback</text>
  <text x="970" y="240" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">âš¡ Search Only: ~2s (no fallback)</text>
  <text x="970" y="255" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">ðŸš€ Task Only: ~120s (no fallback)</text>
  
  <text x="1060" y="280" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#2c3e50">API Timing</text>
  <text x="970" y="295" font-family="Arial, sans-serif" font-size="9" fill="#2c3e50">Task API: 2-5 minutes (high quality)</text>
  <text x="970" y="307" font-family="Arial, sans-serif" font-size="9" fill="#2c3e50">Search API: 10-30 seconds (fast)</text>
  
  <!-- Legend -->
  <rect x="950" y="330" width="220" height="180" rx="5" fill="#ecf0f1" stroke="#bdc3c7"/>
  <text x="1060" y="350" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#2c3e50">Legend</text>
  
  <rect x="960" y="360" width="15" height="15" fill="#3498db"/>
  <text x="985" y="372" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">User Input Layer</text>
  
  <rect x="960" y="380" width="15" height="15" fill="#f39c12"/>
  <text x="985" y="392" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">API Strategy Selection</text>
  
  <rect x="960" y="400" width="15" height="15" fill="#27ae60"/>
  <text x="985" y="412" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">Task API Path</text>
  
  <rect x="960" y="420" width="15" height="15" fill="#2980b9"/>
  <text x="985" y="432" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">Search API Path</text>
  
  <rect x="960" y="440" width="15" height="15" fill="#8e44ad"/>
  <text x="985" y="452" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">Data Processing</text>
  
  <rect x="960" y="460" width="15" height="15" fill="#34495e"/>
  <text x="985" y="472" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">Output Formatting</text>
  
  <circle cx="967" cy="487" r="5" fill="#e74c3c"/>
  <text x="985" y="492" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">Error Handling</text>
  
  <line x1="960" y1="500" x2="975" y2="500" stroke="#e67e22" stroke-width="2" stroke-dasharray="3,2"/>
  <text x="985" y="505" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">Fallback Logic</text>
</svg>